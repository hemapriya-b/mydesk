{% extends "base.html" %}

{% block title %}{{ note.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-file-alt"></i> {{ note.title }}</h4>
                    <div class="btn-group">
                        <a href="{{ url_for('download_note', note_id=note.id) }}" class="btn btn-success btn-sm">
                            <i class="fas fa-download"></i> Download
                        </a>
                        <a href="{{ url_for('delete_note', note_id=note.id) }}" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this note?')">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Note Metadata -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-book text-primary me-2"></i>
                            <strong>Subject:</strong>
                            <span class="ms-2">{{ note.subject.name }}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-folder text-success me-2"></i>
                            <strong>Unit:</strong>
                            <span class="ms-2">{{ note.unit.name }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-calendar text-info me-2"></i>
                            <strong>Created:</strong>
                            <span class="ms-2">{{ note.created_at.strftime('%B %d, %Y at %H:%M') }}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-file text-warning me-2"></i>
                            <strong>File Type:</strong>
                            <span class="ms-2 text-uppercase">{{ note.file_type }}</span>
                        </div>
                    </div>
                </div>

                <!-- Note Description -->
                {% if note.description %}
                <div class="mb-4">
                    <h5><i class="fas fa-align-left"></i> Description</h5>
                    <div class="border rounded p-3 bg-light">
                        {{ note.description|replace('\n', '<br>')|safe }}
                    </div>
                </div>
                {% endif %}

                <!-- File Preview/Info -->
                <div class="mb-4">
                    <h5><i class="fas fa-file"></i> File</h5>
                    <div class="text-center p-4 border rounded">
                        <i class="fas fa-file-{{ 'pdf' if note.file_type == 'pdf' else 'word' if note.file_type in ['doc', 'docx'] else 'image' if note.file_type in ['jpg', 'png', 'jpeg', 'gif'] else 'alt' if note.file_type == 'txt' else 'file' }} fa-4x text-primary mb-3"></i>
                        <h5>{{ note.filename }}</h5>
                        <p class="text-muted">File type: {{ note.file_type|upper }}</p>
                        
                        {% if note.file_type in ['jpg', 'png', 'jpeg', 'gif'] %}
                        <div class="mt-3">
                            <img src="{{ url_for('static', filename='uploads/' + note.filename) }}" 
                                 class="img-fluid rounded" 
                                 style="max-height: 400px;" 
                                 alt="{{ note.title }}">
                        </div>
                        {% elif note.file_type == 'pdf' %}
                        <div class="mt-3">
                            <iframe src="{{ url_for('static', filename='uploads/' + note.filename) }}" 
                                    width="100%" 
                                    height="500px" 
                                    style="border: none;">
                            </iframe>
                        </div>
                        {% elif note.file_type == 'txt' %}
                        <div class="mt-3">
                            <div class="border rounded p-3 bg-light text-start">
                                <pre>{{ file_content }}</pre>
                            </div>
                        </div>
                        {% else %}
                        <p class="text-muted">Preview not available for this file type. Download to view.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="{{ url_for('notes') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Notes
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}